import {IObserver} from '../../../Observer/Observer';
import {Theme} from '../../../Theme/ThemesRegistry';
import Page from '../Page';
import PageModel from '../Page/Model';
import PagePresenter from '../Page/Presenter';
import SideMenuModel from '../SideMenu/Model';
import SideMenuPresenter from '../SideMenu/Presenter';
import TopBarModel from '../TopBar/Model';
import TopBarPresenter from '../TopBar/Presenter';
import Model from './Model';
import Presenter from './Presenter';
import {IStyleUrlFormatter} from './StyleUrlFormatter';

describe('Application.Presenter.ApplicationPresenter', () => {
  let topBarPresenter: TopBarPresenter, topBarPresentSpy: jest.Mock;
  let sideMenuPresenter: SideMenuPresenter, sideMenuPresentSpy: jest.Mock;
  let pagePresenter: PagePresenter, pagePresentSpy: jest.Mock;
  let styleUrlFormatter: IStyleUrlFormatter, themePresentSpy: jest.Mock;
  let themeObserver: IObserver<Theme>;
  let theme: Theme;

  beforeEach(() => {
    theme = {} as Theme;
    themeObserver = {value: theme} as IObserver<Theme>;
    topBarPresenter = {} as TopBarPresenter;
    styleUrlFormatter = {format: jest.fn()};
    sideMenuPresenter = {} as SideMenuPresenter;
    pagePresenter = {} as PagePresenter;

    topBarPresentSpy = topBarPresenter.present = jest.fn();
    sideMenuPresentSpy = sideMenuPresenter.present = jest.fn();
    pagePresentSpy = pagePresenter.present = jest.fn();
  });

  it('Present application data', () => {
    const presenter: Presenter = new Presenter(
      themeObserver,
      topBarPresenter,
      sideMenuPresenter,
      pagePresenter,
      styleUrlFormatter
    );
    const topBarModel: TopBarModel = new TopBarModel();
    topBarModel.title = 'top title';
    const sideMenuModel: SideMenuModel = new SideMenuModel();
    sideMenuModel.isOpen = true;
    const pageModel: PageModel = new PageModel();
    pageModel.module = Page;

    topBarPresentSpy.mockReturnValueOnce(topBarModel);
    sideMenuPresentSpy.mockReturnValueOnce(sideMenuModel);
    pagePresentSpy.mockReturnValueOnce(pageModel);

    const expectedModel: Model = new Model();
    expectedModel.topAppBar = topBarModel;
    expectedModel.sideMenu = sideMenuModel;
    expectedModel.page = pageModel;

    const result = presenter.present();
    expect(result).toEqual(expectedModel);
  });
});
